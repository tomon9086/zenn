---
title: "Electronä¸Šã®Reactã‹ã‚‰File Dialogã‚’å‡ºã™"
emoji: "ğŸ‘“"
type: "tech"
topics:
  - "electron"
  - "react"
  - "ipc"
published: true
published_at: "2021-06-09 20:21"
---

ä½¿ã†APIã¯ã¨ã¦ã‚‚ç°¡å˜ãªã®ã§ã™ãŒã€æ ¸å¿ƒã‚’çªãè¨˜äº‹ãŒè¦‹ã¤ã‹ã‚‰ãªã„æ°—ãŒã™ã‚‹ã®ã§â€¦

# TL; DR
`ipcMain` ã¨ `ipcRenderer` ã‚’ä½¿ã£ã¦ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã« `showOpenDialog` ã•ã›ã‚‹

# ä¾‹
å¤ã„è¨˜äº‹ã«å½“ãŸã‚‹ã¨ã€ãƒ¬ãƒ³ãƒ€ãƒ©ã‹ã‚‰ãƒ¡ã‚¤ãƒ³ã‚’ç›´æ¥å‚ç…§ã™ã‚‹ã£ã½ã„ `remote` ã¨ã„ã†ã‚‚ã®ã‚’ä½¿ã£ã¦ã„ãŸã‚Šã™ã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¯ [deprecated](https://www.electronjs.org/docs/api/remote) ãªã®ã§ä½¿ã‚ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†

ä½¿ã„æ–¹ã¯ Socket.io ã‚’ä½¿ã£ãŸã“ã¨ã®ã‚ã‚‹æ–¹ã«ã¯ç›´æ„Ÿçš„ã ã¨æ€ã„ã¾ã™

```typescript:main.ts
let mainWindow

const addIpcListener = () => {
  ipcMain.on('open-file-dialog', async (event, payload?: OpenDialogOptions) => {
    if (!mainWindow) {
      event.reply('open-file-dialog')
      return
    }

    const value = await dialog.showOpenDialog(mainWindow, {
      ...payload
    })
    event.reply('open-file-dialog', value)
  })
}

const createWindow = async () => {
  mainWindow = new BrowserWindow({ ... })
  addIpcListener()
}
```

```typescript:renderer.ts
ipcRenderer.on('open-file-dialog', (_event, result) => {
  if (result.canceled) {
    return
  }
  
  const filePaths = result.filePaths
  // å‡¦ç†
})

ipcRenderer.send('open-file-dialog', {
  title: 'Select a file',
  filters: [{
    name: 'CSV file',
    extensions: ['csv']
  }]
})
```

Channelã¨å‘¼ã°ã‚Œã‚‹æ–‡å­—åˆ— (ã“ã“ã§ã¯ `'open-file-dialog'`) ã®ä¸€è‡´ã—ãŸãƒªã‚¹ãƒŠãŒå‘¼ã°ã‚Œã¾ã™
ãƒ¬ãƒ³ãƒ€ãƒ©ã‹ã‚‰ `send` ã™ã‚‹ã¨ãƒ¡ã‚¤ãƒ³ã® `on` ã«æ¸¡ã—ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã°ã‚Œã¦ã€ãã®ä¸­ã§ `reply` ã™ã‚‹ã¨ã•ã‚‰ã«ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ãƒ¬ãƒ³ãƒ€ãƒ©ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™

é€šä¿¡å†…å®¹ã¯ãŸã¶ã‚“JSONã‹ãªã«ã‹ãªã®ã§ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºä¸å¯èƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (å¾ªç’°å‚ç…§ã‚’æŒã¤ã‚‚ã®ãªã©) ã¯æ€’ã‚‰ã‚Œã¾ã™

# Tips
ãƒ¬ãƒ³ãƒ€ãƒ©å´ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¿”ã£ã¦ãã‚‹ã¾ã§å¾…ã¡ãŸã‹ã£ãŸã‚Šã™ã‚‹ã®ã§ã€ã“ã†ã„ã†é–¢æ•°ã‚’æ›¸ãã¨æ—ã‚‹ã¨æ€ã„ã¾ã™

```ts:ipc.ts
const ipc = <T, U>(channel: Channel, payload?: T): Promise<U> => new Promise((resolve) => {
  ipcRenderer.once(channel, (_event, args: U) => {
    resolve(args)
  })

  ipcRenderer.send(channel, payload)
})
```
`once` ã¯1åº¦å—ã‘å–ã‚‹ã¨removeã•ã‚Œã‚‹ãƒªã‚¹ãƒŠ (å‚è€ƒ: [ipcRenderer](https://www.electronjs.org/docs/api/ipc-renderer#ipcrendereroncechannel-listener))