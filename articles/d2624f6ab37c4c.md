---
title: "flutter_local_notificationã§ãƒ­ãƒ¼ã‚«ãƒ«é€šçŸ¥ã‚’å‡ºã™æ–¹æ³•"
emoji: "ğŸ””"
type: "tech"
topics:
  - "flutter"
  - "ã‚¢ãƒ—ãƒªé–‹ç™º"
  - "ãƒ­ãƒ¼ã‚«ãƒ«é€šçŸ¥"
published: true
published_at: "2021-08-19 14:09"
---

[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://pub.dev/packages/flutter_local_notifications)ãŒè‹±èªã§é•·ã„ã®ã§ã€ã‚«ã‚¹ã‚¿ãƒ ã¨ã‹ã¯ç½®ã„ã¦ãŠã„ã¦ã¨ã‚Šã‚ãˆãšè©¦ã—ãŸã„äººå‘ã‘ã®æ—¥æœ¬èªã‚¬ã‚¤ãƒ‰ã¨ã—ã¦æ›¸ãã¾ã™ã€‚
å®Ÿè£…ãƒ‘ãƒ¼ãƒˆã®ä¾‹ã¯å„OSã® (ã ã„ãŸã„) ãƒŸãƒ‹ãƒãƒ«ã§ã™ã€‚
iOS / Android ä¸¡æ–¹å®Ÿæ©Ÿã§å‹•ä½œç¢ºèªæ¸ˆã§ã™ã€‚

# æº–å‚™
## iOS
ã‚ã‚ŠãŒã¡ãª `info.plist` ã®ç·¨é›†ã¯ä¸è¦ã§ã™ãŒã€Swiftã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ã‚¸ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ `AppDelegate.swift` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚
```swift
if #available(iOS 10.0, *) {
  UNUserNotificationCenter.current().delegate = self as? UNUserNotificationCenterDelegate
}
```

ã“ã‚ŒãŒãªã„ã¨é€šçŸ¥ãŒå‡ºã¾ã›ã‚“ã€‚
æŒ¿å…¥ã™ã‚‹ä½ç½®ã¯ã ã„ãŸã„ã“ã‚“ãªæ„Ÿã˜ã€‚

```diff swift:ios/Runner/AppDelegate.swift
@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
  override func application(
    _ application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
  ) -> Bool {
+   // flutter_local_notification
+   if #available(iOS 10.0, *) {
+     UNUserNotificationCenter.current().delegate = self as? UNUserNotificationCenterDelegate
+   }

    GeneratedPluginRegistrant.register(with: self)
    return super.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
}
```


## Android
ç‰¹ã«è¨­å®šã—ãªãã¦ã‚‚é€šçŸ¥è‡ªä½“ã¯å‹•ãã¾ã™ãŒã€ãƒãƒŠãƒ¼ã‚’å‡ºã—ãŸã„å ´åˆã¯fullScreenIntentã«å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚‹[^1]ã®ã§ `AndroidManifest.xml` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½åŠ ã—ã¾ã™ã€‚
```diff xml:android/app/src/main/AndroidManifest.xml
  <manifest xmlns:android="http://schemas.android.com/apk/res/android"
      package="com.example.myapp">
    <application
          android:label="myapp"
          android:icon="@mipmap/ic_launcher">
          <activity
              android:name=".MainActivity"
              android:launchMode="singleTop"
              android:theme="@style/LaunchTheme"
              android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
              android:hardwareAccelerated="true"
+             android:showWhenLocked="true"
+             android:turnScreenOn="true">
                ï¸™
```



# å®Ÿè£…
## iOS
ãƒœã‚¿ãƒ³ã‹ä½•ã‹ã«æ›¸ã„ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€é€šçŸ¥æ¨©é™ã®è¨±å¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒå‡ºã¦ã€å³æ™‚ã§ãƒãƒŠãƒ¼ãŒå‡ºã¾ã™ã€‚
```dart
import 'package:flutter_local_notifications/flutter_local_notifications.dart';

Future<void> notify() {
  final flnp = FlutterLocalNotificationsPlugin();
  return flnp.initialize(
    InitializationSettings(
      iOS: IOSInitializationSettings(),
    ),
  ).then((_) => flnp.show(0, 'title', 'body', NotificationDetails()));
}
```

`initialize` ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ¨©é™ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã‚‹ã®ã§ã€ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸã„ã¨ãã¯ `main` ã¨ã‹ã§initializeã—ã¾ã™ã€‚ã¾ãŸã€`initialize` å‰ã« `show` ã‚’å‘¼ã‚“ã§ã‚‚æ¨©é™ãŒãªã„ã®ã§é€šçŸ¥ãŒå‡ºã›ã¾ã›ã‚“ã€‚
ä½•åº¦initializeã—ã¦ã‚‚å•é¡Œãªã•ãã†ãªã®ã§ã€æ¨©é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒåˆã‚ã¦é€šçŸ¥ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‰¯ã‘ã‚Œã°ã€ã“ã®notifyé–¢æ•°ã‚’ã„ã˜ã£ã¦ãƒ©ãƒƒãƒ‘ãƒ¼ã«ã—ã¦ã—ã¾ã£ã¦ã‚‚ä¾¿åˆ©ã ã¨æ€ã„ã¾ã™ã€‚


## Android
Androidã¯é€šçŸ¥ã«ä½¿ã†ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã«initializeãŒå¿…è¦ã§ã™ã€‚
ã¾ãŸã€é€šçŸ¥ãƒãƒ£ãƒãƒ«ã®æ¦‚å¿µãŒå­˜åœ¨ã™ã‚‹ã®ã§ã€NotificationDetailsã«è¨­å®šã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
iOSãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã«è»½ãèª¬æ˜ã™ã‚‹ã¨ã€é€šçŸ¥ãƒãƒ£ãƒãƒ«ã¯é€šçŸ¥ã®ç¨®é¡ã‚’å®šç¾©ã™ã‚‹ã‚‚ã®ã§ã€ãƒ¦ãƒ¼ã‚¶ã¯è¨­å®šã‹ã‚‰ãƒãƒ£ãƒãƒ«ã”ã¨ã«é€šçŸ¥ã‚’ã‚ªãƒ³ã‚ªãƒ•ã§ãã¾ã™ã€‚ä¾‹ãˆã°ECã‚¢ãƒ—ãƒªã§ã€ŒãŠã™ã™ã‚å•†å“ã€ã¨ã€Œã‚¯ãƒ¼ãƒãƒ³æƒ…å ±ã€ã§ãƒãƒ£ãƒãƒ«ã‚’åˆ†ã‘ã¦ãŠãã¨ã€ã‚¯ãƒ¼ãƒãƒ³ã ã‘é€šçŸ¥ãŒã»ã—ã„ãƒ¦ãƒ¼ã‚¶ã¯ãŠã™ã™ã‚å•†å“ã®é€šçŸ¥ã‚’é¸æŠçš„ã«ã‚ªãƒ•ã«ã§ãã¾ã™ã€‚

```dart
import 'package:flutter_local_notifications/flutter_local_notifications.dart';

Future<void> notify() {
  final flnp = FlutterLocalNotificationsPlugin();
  return flnp.initialize(
    InitializationSettings(
      android: AndroidInitializationSettings('@mipmap/ic_launcher'),
    ),
  ).then((_) => flnp.show(0, 'title', 'body', NotificationDetails(
    android: AndroidNotificationDetails(
      'channel_id',
      'channel_name',
      'channel_description',
    ),
  )));
}
```

`AndroidInitializationSettings` ã«æ¸¡ã—ã¦ã„ã‚‹æ–‡å­—åˆ—ãŒæœ€åˆã«è§¦ã‚ŒãŸã€é€šçŸ¥ã«ä½¿ã†ã‚¢ã‚¤ã‚³ãƒ³ã®æŒ‡å®šç®‡æ‰€ã§ã™ã€‚
`android/app/src/main/res/drawable` ã®ä¸­èº«ã‚’ã“ã“ã§æŒ‡å®šã§ãã‚‹ã‚ˆã†ãªã®ã§ã€ã‚«ã‚¹ã‚¿ãƒ ã—ãŸã„å ´åˆã¯ã“ã“ã«ç”»åƒã‚’æ ¼ç´ã—ã¦ã€æ‹¡å¼µå­ãªã—ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ–‡å­—åˆ—ã§æ¸¡ã™ã“ã¨ã«ãªã‚Šãã†ã§ã™ã€‚
ä¾‹ãˆã°ã€`android/app/src/main/res/drawable/icon.png` ã‚’ä½¿ã„ãŸã‘ã‚Œã° `AndroidInitializationSettings('icon')` ã¨ã„ã†æ„Ÿã˜ã€‚

ãƒãƒŠãƒ¼ã‚’å‡ºã—ãŸã„å ´åˆã¯é‡è¦åº¦ã®è¨­å®šãŒå¿…è¦[^1]ã§ã™ã€‚

```diff dart
  flnp.show(0, 'title', 'body', NotificationDetails(
    android: AndroidNotificationDetails(
      'channel_id',
      'channel_name',
      'channel_description',
+     importance: Importance.high,
+     priority: Priority.high,
    ),
  ))
```

`importance` ã¯ Android 8.0 (API ãƒ¬ãƒ™ãƒ« 26) ä»¥é™ã€`priority` ã¯ Android 7.1 (API ãƒ¬ãƒ™ãƒ« 25) ä»¥å‰ã®ãŸã‚ã®è¨­å®šã®ã‚ˆã†ã§ã™ã€‚


# é€šçŸ¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
é€šçŸ¥ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã™ã‚‹å ´åˆã¯ `show` ã®ä»£ã‚ã‚Šã« `zonedSchedule` ã‚’ä½¿ã„ã¾ã™ã€‚
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ä½¿ã‚ã‚Œã‚‹æ™‚åˆ»ã¯Dartæ¨™æº–ã®DateTimeã§ã¯ãªãã€[TZDateTime](https://pub.dev/packages/timezone) ãªã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦importã—ã¾ã™ã€‚

```diff dart
  import 'package:flutter_local_notifications/flutter_local_notifications.dart';
+ import 'package:timezone/timezone.dart' as tz;
```

```dart
flnp.zonedSchedule(
  0,
  'title',
  'body',
  tz.TZDateTime.now(tz.UTC).add(Duration(seconds: 3)),
  NotificationDetails(
    android: androidNotificationDetails,
    ios: iOSNotificationDetails,
  ),
  androidAllowWhileIdle: true,
  uiLocalNotificationDateInterpretation: UILocalNotificationDateInterpretation.absoluteTime,
)
```

iOSã ã‘ã§ä½¿ã†å ´åˆã‚‚ `androidAllowWhileIdle` ã¯å¿…é ˆãªã®ã§è¨­å®šã—ã¾ã™ã€‚


# æ¤œè¨¼ç’°å¢ƒ
- macOS 11.4 on x86
- Flutter 2.2.3
- Dart 2.13.4
- Xcode 12.5.1
- Android Studio 2020.3.1
- ãƒ†ã‚¹ãƒˆæ©Ÿ
	- iPhone 11 Pro (iOS 14.7.1)
	- Pixel 3a (Android 11)


[^1]: ãƒãƒŠãƒ¼ã‚’å‡ºã™ãŸã‚ã®è¨­å®šã«ã¤ã„ã¦ [Android Developers - ãƒ˜ãƒƒãƒ‰ã‚¢ãƒƒãƒ—é€šçŸ¥](https://developer.android.com/guide/topics/ui/notifiers/notifications.html#Heads-up)